# 0009 结构化日程表抽象与工具化支持

- 日期: 2026-01-05
- 状态: active
- 负责人: AI
- 变更类型: refactor
- 影响范围: utils/storage.py, core/tools.py, config.py, readme.md, docs/memory_guidelines.md
- 关联: 日程表抽象层设计
- 约束与风险: routine.json 格式升级后需通过工具函数维护，避免手写破坏结构
- 环境/版本: N/A

## 0. 问题/目标 (Context)
课表是大学生核心场景，但项目需要保持通用性。要求以“按天日程表”替代课表专有结构，并在每次 LLM 上下文中提供友好摘要，同时提供可操作的工具函数。

## 1. 方案对比 (Options)
### 方案 A
- 优点: 保留原有自由文本或旧结构，改动少
- 缺点: 无法稳定支持冲突检测、移动/调整
- 成本: 低

### 方案 B
- 优点: 结构化日程表抽象通用，能覆盖课程/假期/活动
- 缺点: 需要工具函数与摘要逻辑
- 成本: 中

## 2. 决策 (Decision)
选择方案 B。将 routine.json 升级为按天的结构化日程表，所有调课/维护视作日程变更。

## 3. 设计与实现 (Design & Implementation)
- routine.json 作为结构化日程表存储，按天记录事项。
- 不引入课表专用单位与单双周逻辑，全部以具体日期表达。
- 全局上下文不再注入原始 JSON，改为注入“日程摘要”。
- 新增日程表工具函数：查看、添加、更新、移动、删除、清空。
- 文档与默认可见文件列表同步更新。

## 4. 实验与效果 (Experiment & Result)
N/A（设计与实现阶段，待实际使用验证）。

## 5. 测试与优化 (Tests & Optimization)
- [ ] 单元测试: N/A
- [ ] 集成测试: N/A
- [ ] 手动验证: N/A
- 结果/备注: 未执行测试。

## 6. 结论与收获 (Lessons)
按天结构化的日程表可以覆盖课程与非课程场景，保持通用性同时降低维护成本。

## 7. 后续行动 (Next)
- 约定 routine.json 的字段规范与示例。
- 增加日程冲突提示与可视化检查。
